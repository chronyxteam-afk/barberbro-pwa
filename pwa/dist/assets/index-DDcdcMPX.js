import{r as y,a as ne,R as K}from"./react-vendor-CIP6LD3P.js";import{c as ie}from"./store-CtB4bYHU.js";import{b as H,i as J,a as M,c as $,d as le,p as G,f as Z}from"./utils-kVcadHLY.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();var ee={exports:{}},O={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ce=y,de=Symbol.for("react.element"),me=Symbol.for("react.fragment"),ue=Object.prototype.hasOwnProperty,pe=ce.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,he={key:!0,ref:!0,__self:!0,__source:!0};function te(r,s,t){var a,o={},n=null,c=null;t!==void 0&&(n=""+t),s.key!==void 0&&(n=""+s.key),s.ref!==void 0&&(c=s.ref);for(a in s)ue.call(s,a)&&!he.hasOwnProperty(a)&&(o[a]=s[a]);if(r&&r.defaultProps)for(a in s=r.defaultProps,s)o[a]===void 0&&(o[a]=s[a]);return{$$typeof:de,type:r,key:n,ref:c,props:o,_owner:pe.current}}O.Fragment=me;O.jsx=te;O.jsxs=te;ee.exports=O;var e=ee.exports,re,V=ne;re=V.createRoot,V.hydrateRoot;function xe(r={}){const{nonce:s,onScriptLoadSuccess:t,onScriptLoadError:a}=r,[o,n]=y.useState(!1),c=y.useRef(t);c.current=t;const m=y.useRef(a);return m.current=a,y.useEffect(()=>{const l=document.createElement("script");return l.src="https://accounts.google.com/gsi/client",l.async=!0,l.defer=!0,l.nonce=s,l.onload=()=>{var i;n(!0),(i=c.current)===null||i===void 0||i.call(c)},l.onerror=()=>{var i;n(!1),(i=m.current)===null||i===void 0||i.call(m)},document.body.appendChild(l),()=>{document.body.removeChild(l)}},[s]),o}const ae=y.createContext(null);function fe({clientId:r,nonce:s,onScriptLoadSuccess:t,onScriptLoadError:a,children:o}){const n=xe({nonce:s,onScriptLoadSuccess:t,onScriptLoadError:a}),c=y.useMemo(()=>({clientId:r,scriptLoadedSuccessfully:n}),[r,n]);return K.createElement(ae.Provider,{value:c},o)}function ge(){const r=y.useContext(ae);if(!r)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return r}function ve(r){var s;return(s=r==null?void 0:r.clientId)!==null&&s!==void 0?s:r==null?void 0:r.client_id}const be={large:40,medium:32,small:20};function ye({onSuccess:r,onError:s,useOneTap:t,promptMomentNotification:a,type:o="standard",theme:n="outline",size:c="large",text:m,shape:l,logo_alignment:i,width:u,locale:p,click_listener:h,containerProps:d,...b}){const g=y.useRef(null),{clientId:x,scriptLoadedSuccessfully:v}=ge(),f=y.useRef(r);f.current=r;const j=y.useRef(s);j.current=s;const w=y.useRef(a);return w.current=a,y.useEffect(()=>{var _,P,z,I,L,R,F,W,U;if(v)return(z=(P=(_=window==null?void 0:window.google)===null||_===void 0?void 0:_.accounts)===null||P===void 0?void 0:P.id)===null||z===void 0||z.initialize({client_id:x,callback:S=>{var D;if(!(S!=null&&S.credential))return(D=j.current)===null||D===void 0?void 0:D.call(j);const{credential:C,select_by:se}=S;f.current({credential:C,clientId:ve(S),select_by:se})},...b}),(R=(L=(I=window==null?void 0:window.google)===null||I===void 0?void 0:I.accounts)===null||L===void 0?void 0:L.id)===null||R===void 0||R.renderButton(g.current,{type:o,theme:n,size:c,text:m,shape:l,logo_alignment:i,width:u,locale:p,click_listener:h}),t&&((U=(W=(F=window==null?void 0:window.google)===null||F===void 0?void 0:F.accounts)===null||W===void 0?void 0:W.id)===null||U===void 0||U.prompt(w.current)),()=>{var S,D,C;t&&((C=(D=(S=window==null?void 0:window.google)===null||S===void 0?void 0:S.accounts)===null||D===void 0?void 0:D.id)===null||C===void 0||C.cancel())}},[x,v,t,o,n,c,m,l,i,u,p]),K.createElement("div",{...d,ref:g,style:{height:be[c],...d==null?void 0:d.style}})}const je={};function we(r,s){let t;try{t=r()}catch{return}return{getItem:o=>{var n;const c=l=>l===null?null:JSON.parse(l,void 0),m=(n=t.getItem(o))!=null?n:null;return m instanceof Promise?m.then(c):c(m)},setItem:(o,n)=>t.setItem(o,JSON.stringify(n,void 0)),removeItem:o=>t.removeItem(o)}}const T=r=>s=>{try{const t=r(s);return t instanceof Promise?t:{then(a){return T(a)(t)},catch(a){return this}}}catch(t){return{then(a){return this},catch(a){return T(a)(t)}}}},Ne=(r,s)=>(t,a,o)=>{let n={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:x=>x,version:0,merge:(x,v)=>({...v,...x}),...s},c=!1;const m=new Set,l=new Set;let i;try{i=n.getStorage()}catch{}if(!i)return r((...x)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),t(...x)},a,o);const u=T(n.serialize),p=()=>{const x=n.partialize({...a()});let v;const f=u({state:x,version:n.version}).then(j=>i.setItem(n.name,j)).catch(j=>{v=j});if(v)throw v;return f},h=o.setState;o.setState=(x,v)=>{h(x,v),p()};const d=r((...x)=>{t(...x),p()},a,o);let b;const g=()=>{var x;if(!i)return;c=!1,m.forEach(f=>f(a()));const v=((x=n.onRehydrateStorage)==null?void 0:x.call(n,a()))||void 0;return T(i.getItem.bind(i))(n.name).then(f=>{if(f)return n.deserialize(f)}).then(f=>{if(f)if(typeof f.version=="number"&&f.version!==n.version){if(n.migrate)return n.migrate(f.state,f.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return f.state}).then(f=>{var j;return b=n.merge(f,(j=a())!=null?j:d),t(b,!0),p()}).then(()=>{v==null||v(b,void 0),c=!0,l.forEach(f=>f(b))}).catch(f=>{v==null||v(void 0,f)})};return o.persist={setOptions:x=>{n={...n,...x},x.getStorage&&(i=x.getStorage())},clearStorage:()=>{i==null||i.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>g(),hasHydrated:()=>c,onHydrate:x=>(m.add(x),()=>{m.delete(x)}),onFinishHydration:x=>(l.add(x),()=>{l.delete(x)})},g(),b||d},_e=(r,s)=>(t,a,o)=>{let n={storage:we(()=>localStorage),partialize:g=>g,version:0,merge:(g,x)=>({...x,...g}),...s},c=!1;const m=new Set,l=new Set;let i=n.storage;if(!i)return r((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),t(...g)},a,o);const u=()=>{const g=n.partialize({...a()});return i.setItem(n.name,{state:g,version:n.version})},p=o.setState;o.setState=(g,x)=>{p(g,x),u()};const h=r((...g)=>{t(...g),u()},a,o);o.getInitialState=()=>h;let d;const b=()=>{var g,x;if(!i)return;c=!1,m.forEach(f=>{var j;return f((j=a())!=null?j:h)});const v=((x=n.onRehydrateStorage)==null?void 0:x.call(n,(g=a())!=null?g:h))||void 0;return T(i.getItem.bind(i))(n.name).then(f=>{if(f)if(typeof f.version=="number"&&f.version!==n.version){if(n.migrate)return[!0,n.migrate(f.state,f.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,f.state];return[!1,void 0]}).then(f=>{var j;const[w,_]=f;if(d=n.merge(_,(j=a())!=null?j:h),t(d,!0),w)return u()}).then(()=>{v==null||v(d,void 0),d=a(),c=!0,l.forEach(f=>f(d))}).catch(f=>{v==null||v(void 0,f)})};return o.persist={setOptions:g=>{n={...n,...g},g.storage&&(i=g.storage)},clearStorage:()=>{i==null||i.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>b(),hasHydrated:()=>c,onHydrate:g=>(m.add(g),()=>{m.delete(g)}),onFinishHydration:g=>(l.add(g),()=>{l.delete(g)})},n.skipHydration||b(),d||h},Se=(r,s)=>"getStorage"in s||"serialize"in s||"deserialize"in s?((je?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Ne(r,s)):_e(r,s),ke=Se,Ie="https://script.google.com/macros/s/AKfycbzQWBKn8ZjafSJGgdgiLd9dfYLCvMnzsAvhmrbLXxbaRrU0SskFh5kQau7gjOq_aza2HQ/exec";class De{constructor(s){this.baseUrl=s}async fetchAPI(s,t={}){var a,o;try{let n=null;try{const p=localStorage.getItem("barberbro-storage");p&&(n=(o=(a=JSON.parse(p).state)==null?void 0:a.auth)==null?void 0:o.token)}catch(p){console.warn("‚ö†Ô∏è Errore lettura token da persist:",p)}const c=n?`&authorization=${encodeURIComponent(n)}`:"";let m="";if(t.params)for(const[p,h]of Object.entries(t.params))h!=null&&(m+=`&${encodeURIComponent(p)}=${encodeURIComponent(h)}`);const l=`${this.baseUrl}?endpoint=${s}${c}${m}`,i=await fetch(l,{...t});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const u=await i.json();return u.statusCode===401&&(console.warn("üîí Token scaduto, ricarica necessaria"),localStorage.removeItem("barberbro-storage"),window.location.reload()),u}catch(n){return console.error(`API Error [${s}]:`,n),{success:!1,error:n.message}}}async postAPI(s){var t,a;try{let o=null;try{const i=localStorage.getItem("barberbro-storage");i&&(o=(a=(t=JSON.parse(i).state)==null?void 0:t.auth)==null?void 0:a.token)}catch(i){console.warn("‚ö†Ô∏è Errore lettura token da persist:",i)}const n=new URLSearchParams;for(const[i,u]of Object.entries(s))u!=null&&n.append(i,typeof u=="object"?JSON.stringify(u):String(u));o&&n.append("authorization",o);const c=`${this.baseUrl}?${n.toString()}`,m=await fetch(c,{method:"GET"});if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);return await m.json()}catch(o){return console.error("API POST Error:",o),{success:!1,error:o.message}}}async login(s){try{const t=`${this.baseUrl}?endpoint=login&email=${encodeURIComponent(s)}`,a=await fetch(t);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.json()}catch(t){return console.error("Login error:",t),{success:!1,error:t.message}}}async getConfig(){return this.fetchAPI("config")}async getServices(){return this.fetchAPI("servizi")}async getOperators(){return this.fetchAPI("operatori")}async getSlots(s={}){return this.fetchAPI("slot",{params:s})}async getCustomer(s){const t=new URLSearchParams({action:"cliente",phone:s});try{return await(await fetch(`${this.baseUrl}?${t}`)).json()}catch(a){return console.error("getCustomer error:",a),{success:!1,error:a.message}}}async getMyBookings(s){var t,a;try{let o=null;try{const l=localStorage.getItem("barberbro-storage");l&&(o=(a=(t=JSON.parse(l).state)==null?void 0:t.auth)==null?void 0:a.token)}catch(l){console.warn("‚ö†Ô∏è Errore lettura token da persist:",l)}const n=new URLSearchParams({action:"prenotazioni",phone:s});o&&n.append("authorization",o);const m=await(await fetch(`${this.baseUrl}?${n}`)).json();return m.statusCode===401&&(console.warn("üîí Token scaduto, ricarica necessaria"),localStorage.removeItem("barberbro-storage"),window.location.reload()),m}catch(o){return console.error("getMyBookings error:",o),{success:!1,error:o.message}}}async createBooking(s){return this.postAPI({action:"prenota",...s})}async cancelBooking(s,t){return this.postAPI({action:"cancella",appointmentId:s,phone:t})}}const k=new De(Ie),E=r=>{if(!r||typeof r!="string")return null;const[s,t]=r.split(" ");if(!s||!t)return null;const[a,o,n]=s.split("/"),[c,m,l]=t.split(":"),i=`${n}-${o.padStart(2,"0")}-${a.padStart(2,"0")}T${c.padStart(2,"0")}:${m.padStart(2,"0")}:${(l==null?void 0:l.padStart(2,"0"))||"00"}`,u=new Date(i);return isNaN(u.getTime())?null:u},N=ie(ke((r,s)=>({config:{shop_name:"BarberBro",shop_logo_url:"",primary_color:"#007AFF",primary_color_dark:"#0051D5",secondary_color:"#34C759",accent_color:"#C19A6B",background_color:"#F5F5F7",text_color:"#1D1D1F",text_secondary_color:"#86868B",phone_contact:"+39 333 123 4567",address:"Via Principale 1",maps_url:"",booking_days:30,min_notice_hours:2,show_ratings:!0,require_phone:!0,welcome_message:"Benvenuto! Prenota il tuo appuntamento in pochi click."},auth:{isAuthenticated:!1,token:null,user:null},customer:null,isReturningCustomer:!1,services:[],operators:[],slots:[],allSlots:[],currentStep:"welcome",selectedService:null,selectedOperator:null,selectedSlot:null,selectedPath:null,preferences:{timeSlot:null,preferredDays:[],whenBooking:"asap"},loading:!1,error:null,myBookings:[],login:async(t,a)=>{r({loading:!0,error:null});try{const o=await k.login(t);return o.success?(r({auth:{isAuthenticated:!0,token:o.token,user:o.user},customer:{name:o.user.name,email:o.user.email,phone:o.user.phone},loading:!1}),console.log("‚úÖ Login riuscito:",o.user.name),{success:!0}):{success:!1,error:o.error||"Login fallito"}}catch(o){return r({error:o.message,loading:!1}),{success:!1,error:o.message}}},logout:()=>{r({auth:{isAuthenticated:!1,token:null,user:null},customer:null,currentStep:"welcome"}),console.log("üëã Logout eseguito")},checkAuth:async()=>{var a,o;const t=s().auth;return!(t!=null&&t.token)||!((a=t==null?void 0:t.user)!=null&&a.email)?(console.log("‚ùå Auth non presente, login necessario"),r({auth:{isAuthenticated:!1,token:null,user:null}}),!1):(console.log("‚úÖ Auth recuperato da cache:",(o=t.user)==null?void 0:o.email),typeof t.token!="string"||t.token.trim()===""?(console.warn("‚ö†Ô∏è Token vuoto o invalido, logout"),r({auth:{isAuthenticated:!1,token:null,user:null}}),!1):!0)},loadConfig:async()=>{r({loading:!0,error:null});try{const t=await k.getConfig();if(t.success)r({config:t.config,loading:!1});else throw new Error(t.error)}catch(t){r({error:t.message,loading:!1})}},loadCustomer:async()=>{var a,o;const t=localStorage.getItem("barberbro_customer_phone");if(t)try{const n=await k.getCustomer(t);n.success&&n.found&&r({customer:n.customer,isReturningCustomer:!0,preferences:{...s().preferences,favoriteOperator:(a=n.preferences)==null?void 0:a.favoriteOperator,favoriteService:(o=n.preferences)==null?void 0:o.favoriteService}})}catch(n){console.error("Errore caricamento cliente:",n)}},loadServices:async()=>{r({loading:!0});try{const t=await k.getServices();if(t.success&&t.servizi){console.log("‚úÖ Servizi caricati:",t.servizi.length);const a=t.servizi.map(o=>({sv_ID:o.id,sv_name:o.name,sv_category:o.category||"Altro",sv_duration:o.duration,sv_price:o.price,sv_description:o.description||"",sv_info:o.info||""}));r({services:a,loading:!1})}else console.error("‚ùå Errore caricamento servizi:",t.error),r({loading:!1,error:t.error})}catch(t){console.error("‚ùå Errore loadServices:",t),r({error:t.message,loading:!1})}},loadOperators:async()=>{r({loading:!0});try{const t=await k.getOperators();if(t.success&&t.operatori){console.log("‚úÖ Operatori caricati:",t.operatori.length);const a=t.operatori.map(o=>({op_ID:o.id,op_name:o.name,op_workStart:o.workStart,op_workEnd:o.workEnd,op_breakStart:o.breakStart,op_breakEnd:o.breakEnd,op_image:o.image||""}));r({operators:a,loading:!1})}else console.error("‚ùå Errore caricamento operatori:",t.error),r({loading:!1,error:t.error})}catch(t){console.error("‚ùå Errore loadOperators:",t),r({error:t.message,loading:!1})}},loadSlots:async(t={})=>{r({loading:!0});try{const a={};t.servizioId&&(a.servizioId=t.servizioId),console.log("üîç loadSlots - carico slot con filtri:",a.servizioId?`servizio ${a.servizioId}`:"TUTTI gli slot liberi");const o=await k.getSlots(a);console.log("üì¶ Risposta API slot:",o);const n=s().config,c=s().services,m=n.buffer_prima||0,l=n.buffer_dopo||0;if(o.success&&o.slots){console.log("‚úÖ Slot caricati dall'API:",o.slots.length);let i=0;const u=o.slots.filter(p=>E(p.at_startDateTime)?!0:(console.warn("‚ö†Ô∏è Slot con data invalida ignorato:",p),i++,!1)).map(p=>{const h=E(p.at_startDateTime),d=c.find(v=>v.sv_ID===p.sv_ID),g=((d==null?void 0:d.sv_duration)||30)+m+l,x=new Date(h.getTime()+g*6e4);return{...p,at_endDateTime:x.toISOString(),at_endDateTime_formatted:x.toLocaleString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}});r({slots:u,allSlots:u,loading:!1}),i>0&&console.warn(`‚ö†Ô∏è ${i} slot con date invalide sono stati scartati`),console.log(`‚è±Ô∏è Calcolato at_endDateTime per ${u.length} slot validi (buffer: ${m+l}min)`),console.log(`üìä Riepilogo: API=${o.slots.length} | Invalidi=${i} | Validi=${u.length}`)}else o.success&&o.slots===void 0?(console.warn("‚ö†Ô∏è API success ma slots undefined, array vuoto?"),r({slots:[],allSlots:[],loading:!1})):(console.error("‚ùå Errore caricamento slot:",o.error||"Errore sconosciuto"),console.error("üìã Risposta completa:",JSON.stringify(o)),r({loading:!1,error:o.error||"Errore caricamento slot"}))}catch(a){console.error("‚ùå Errore loadSlots:",a),r({error:a.message,loading:!1})}},filterSlots:(t={})=>{const a=s().allSlots||[],o=s().preferences;let n=[...a];if(t.servizioId&&(n=n.filter(l=>l.sv_ID===t.servizioId)),t.operatoreId&&(n=n.filter(l=>l.or_ID===t.operatoreId)),t.data){const l=new Date(t.data).toDateString();n=n.filter(i=>{const u=E(i.at_startDateTime);return u&&u.toDateString()===l})}const c=o==null?void 0:o.timeSlot;c&&c!=="flexible"&&(n=n.filter(l=>{const i=E(l.at_startDateTime);if(!i)return!1;const u=i.getHours();return c==="morning"?u>=8&&u<12:c==="afternoon"?u>=12&&u<18:c==="evening"?u>=18&&u<21:!0})),n.sort((l,i)=>{const u=E(l.at_startDateTime),p=E(i.at_startDateTime);return!u||!p?0:u-p});const m=[];t.servizioId&&m.push(`servizio: ${t.servizioId}`),t.operatoreId&&m.push(`operatore: ${t.operatoreId}`),c&&c!=="flexible"&&m.push(`fascia: ${c}`),console.log(`üîç Filtro client-side: ${a.length} ‚Üí ${n.length} slot ${m.length>0?`(${m.join(", ")})`:"(nessun filtro)"}`),r({slots:n})},createBooking:async t=>{r({loading:!0});try{console.log("üìù Invio prenotazione al backend:",t);const a=await k.createBooking(t);if(a.success)return localStorage.setItem("barberbro_customer_phone",t.customerPhone),r({customer:{name:t.customerName,phone:t.customerPhone,email:t.customerEmail},loading:!1}),console.log("‚úÖ Prenotazione confermata:",a),a;throw new Error(a.error||"Errore nella prenotazione")}catch(a){throw console.error("‚ùå Errore createBooking:",a),r({error:a.message,loading:!1}),a}},loadMyBookings:async()=>{var t;r({loading:!0});try{const a=s().customer,o=(a==null?void 0:a.phone)||localStorage.getItem("barberbro_customer_phone");if(!o){console.warn("‚ö†Ô∏è Nessun telefono cliente trovato"),r({myBookings:[],loading:!1});return}console.log("üìã Caricamento prenotazioni per:",o);const n=await k.getMyBookings(o);if(n.success)r({myBookings:n.bookings||[],loading:!1}),console.log("‚úÖ Prenotazioni caricate:",((t=n.bookings)==null?void 0:t.length)||0);else throw new Error(n.error||"Errore nel caricamento prenotazioni")}catch(a){console.error("‚ùå Errore loadMyBookings:",a),r({error:a.message,myBookings:[],loading:!1})}},cancelBooking:async t=>{r({loading:!0});try{const a=s().customer,o=(a==null?void 0:a.phone)||localStorage.getItem("barberbro_customer_phone");if(!o)throw new Error("Telefono cliente non trovato");console.log("‚ùå Cancellazione prenotazione:",t);const n=await k.cancelBooking(t,o);if(n.success)return r({myBookings:s().myBookings.filter(c=>c.at_ID!==t),loading:!1}),console.log("‚úÖ Prenotazione cancellata"),n;throw new Error(n.error||"Errore nella cancellazione")}catch(a){throw console.error("‚ùå Errore cancelBooking:",a),r({error:a.message,loading:!1}),a}},setStep:t=>r({currentStep:t}),nextStep:()=>{const t=["welcome","service","operators","calendar","form","confirm"],a=t.indexOf(s().currentStep);a<t.length-1&&r({currentStep:t[a+1]})},prevStep:()=>{const t=["welcome","service","operators","calendar","form","confirm"],a=t.indexOf(s().currentStep);a>0&&r({currentStep:t[a-1]})},selectService:t=>r({selectedService:t}),selectOperator:t=>r({selectedOperator:t}),selectSlot:t=>{var o;const a=s();if(r({selectedSlot:t}),((o=a.selectedOperator)==null?void 0:o.op_ID)==="all"&&t.op_ID){const n=a.operators.find(c=>c.op_ID===t.op_ID);n&&(console.log(`üçÄ Mi sento fortunato ‚Üí Operatore assegnato: ${n.op_name}`),r({selectedOperator:n}))}},selectPath:t=>r({selectedPath:t}),setPreferences:t=>r({preferences:{...s().preferences,...t}}),resetBooking:()=>r({selectedService:null,selectedOperator:null,selectedSlot:null,selectedPath:null,currentStep:"welcome"}),clearError:()=>r({error:null})}),{name:"barberbro-storage",partialize:r=>({auth:r.auth,config:r.config,customer:r.customer,isReturningCustomer:r.isReturningCustomer,services:r.services,operators:r.operators,slots:r.slots,allSlots:r.allSlots,preferences:r.preferences})}));function X(){var l;const{config:r,customer:s,isReturningCustomer:t,setPreferences:a,setStep:o,logout:n,auth:c}=N(),m=i=>{a({timeSlot:i}),o("service")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-white to-[#f5f5f7]",children:[e.jsx("div",{className:"absolute top-4 right-4",children:e.jsxs("button",{onClick:n,className:"flex items-center gap-2 px-4 py-2 text-sm text-[#86868b] hover:text-[#1d1d1f] transition-colors",children:[e.jsx("span",{children:((l=c==null?void 0:c.user)==null?void 0:l.email)||"Account"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-6 pt-12 pb-8 text-center animate-fadeIn",children:[e.jsx("div",{className:"mb-6",children:r!=null&&r.shop_logo_url?e.jsx("img",{src:r.shop_logo_url,alt:r.shop_name,className:"w-20 h-20 mx-auto rounded-[24px] shadow-lg object-cover"}):e.jsx("div",{className:"w-20 h-20 mx-auto rounded-[24px] shadow-lg flex items-center justify-center text-4xl",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-primary-dark))"},children:"üíà"})}),e.jsx("h1",{className:"text-4xl font-semibold mb-3 tracking-tight",style:{color:"var(--color-text)"},children:(r==null?void 0:r.shop_name)||"BarberBro"}),e.jsx("p",{className:"text-lg mb-8 font-normal",style:{color:"var(--color-text-secondary)"},children:(r==null?void 0:r.welcome_message)||"Prenota il tuo appuntamento in pochi tap"}),t&&s&&e.jsx("div",{className:"card mb-6 animate-scaleIn bg-gradient-to-br from-blue-50 to-white",style:{borderColor:"var(--color-primary)",borderOpacity:.2},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-xl shadow-md",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-primary-dark))"},children:"üëã"}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:"Bentornato"}),e.jsx("p",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:s.name})]})]})}),e.jsxs("div",{className:"mt-8",children:[e.jsx("p",{className:"text-sm font-medium text-[#86868b] mb-3 uppercase tracking-wide",children:"Preferenza orario"}),e.jsxs("div",{className:"space-y-3 max-w-lg mx-auto",children:[e.jsx("button",{onClick:()=>m("flexible"),className:"card-hover w-full p-5 bg-gradient-to-r from-[var(--color-primary)] to-[var(--color-accent)] text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-[18px] font-bold mb-1",children:"üçÄ Primo disponibile"}),e.jsx("p",{className:"text-[12px] opacity-90",children:"Mostrami tutti gli slot"})]}),e.jsx("div",{className:"text-2xl",children:"‚ú®"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>m("morning"),className:"card-hover p-4 flex flex-col items-center gap-2 group",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",className:"w-10 h-10 text-[var(--color-primary)]",stroke:"currentColor",fill:"none",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round","aria-label":"Mattina",children:[e.jsx("path",{d:"M12 44h40"}),e.jsx("path",{d:"M20 44a12 12 0 0 1 24 0"}),e.jsx("path",{d:"M32 14v6M18 22l4 4M46 22l-4 4M12 32h6M46 32h6M22 14l2 5M40 14l-2 5"})]}),e.jsx("span",{className:"text-[14px] font-medium text-[#1d1d1f]",children:"Mattino"}),e.jsx("span",{className:"text-[11px] text-[#86868b]",children:"8:00 - 12:00"})]}),e.jsxs("button",{onClick:()=>m("afternoon"),className:"card-hover p-4 flex flex-col items-center gap-2 group",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",className:"w-10 h-10 text-[var(--color-accent)]",stroke:"currentColor",fill:"none",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round","aria-label":"Pomeriggio",children:[e.jsx("circle",{cx:"42",cy:"22",r:"10"}),e.jsx("path",{d:"M42 8v4M42 32v4M56 22h-4M32 22h-4M51 13l-3 3M33 31l3-3M51 31l-3-3M33 13l3 3"}),e.jsx("path",{d:"M12 48h40"})]}),e.jsx("span",{className:"text-[14px] font-medium text-[#1d1d1f]",children:"Pomeriggio"}),e.jsx("span",{className:"text-[11px] text-[#86868b]",children:"12:00 - 18:00"})]}),e.jsxs("button",{onClick:()=>m("evening"),className:"card-hover p-4 flex flex-col items-center gap-2 group col-span-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",className:"w-10 h-10 text-[var(--color-secondary)]",stroke:"currentColor",fill:"none",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round","aria-label":"Sera",children:[e.jsx("path",{d:"M40 14a14 14 0 1 0 10 24a12 12 0 1 1-10-24z"}),e.jsx("path",{d:"M20 20l0 4M18 22l4 0"}),e.jsx("path",{d:"M26 12l0 3M24.5 13.5l3 0"}),e.jsx("path",{d:"M18 48h28"})]}),e.jsx("span",{className:"text-[14px] font-medium text-[#1d1d1f]",children:"Sera"}),e.jsx("span",{className:"text-[11px] text-[#86868b]",children:"Dalle 18:00 in poi"})]})]})]})]}),e.jsx("button",{onClick:()=>o("my-bookings"),className:"btn-text mt-6",children:"üìÖ Le mie prenotazioni"})]}),e.jsxs("div",{className:"max-w-2xl mx-auto px-6 pb-12",children:[e.jsx("div",{className:"card bg-[#f5f5f7] border-0",children:e.jsxs("div",{className:"space-y-3 text-center",children:[(r==null?void 0:r.address)&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-[#86868b]",children:[e.jsx("span",{children:"üìç"}),e.jsx("span",{className:"text-[15px]",children:r.address})]}),(r==null?void 0:r.phone_contact)&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-[#86868b]",children:[e.jsx("span",{children:"üìû"}),e.jsx("span",{className:"text-[15px]",children:r.phone_contact})]})]})}),e.jsx("div",{className:"text-center mt-8",children:e.jsxs("p",{className:"text-xs text-[#86868b]",children:["Powered by ",e.jsx("span",{className:"font-semibold",children:"BarberBro"})," v2.1"]})})]})]})}function Pe(){const{services:r,selectService:s,filterSlots:t,setStep:a,prevStep:o}=N(),n=l=>{s(l),t({servizioId:l.sv_ID}),a("operators")},c=r.reduce((l,i)=>{const u=i.sv_category||"Altro";return l[u]||(l[u]=[]),l[u].push(i),l},{}),m=Object.keys(c).sort((l,i)=>{const u={Capelli:1,Barba:2},p=u[l]||999,h=u[i]||999;return p!==h?p-h:l.localeCompare(i)});return e.jsxs("div",{className:"min-h-screen bg-[#f5f5f7]",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-apple border-b border-[#d2d2d7] sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-6 py-4 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>o(),className:"text-[#007AFF] text-[17px] font-medium hover:opacity-60 transition-opacity",children:"‚Üê Indietro"}),e.jsx("h2",{className:"text-[17px] font-semibold text-[#1d1d1f] flex-1 text-center",children:"Scegli il servizio"}),e.jsx("div",{className:"w-20"})," "]})}),e.jsx("div",{className:"max-w-2xl mx-auto px-6 py-6 space-y-8 animate-fadeIn",children:m.map(l=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-[22px] font-bold text-[#1d1d1f] px-2",children:l}),e.jsx("div",{className:"space-y-3",children:c[l].map((i,u)=>e.jsx("button",{onClick:()=>n(i),className:"card-hover w-full text-left p-5",style:{animationDelay:`${u*50}ms`},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-[17px] text-[#1d1d1f] mb-2",children:i.sv_name}),e.jsxs("div",{className:"flex items-center gap-4 text-[15px] text-[#86868b] mb-2",children:[e.jsxs("span",{children:["‚è± ",i.sv_duration," min"]}),i.sv_price&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{className:"font-medium text-[#007AFF]",children:["‚Ç¨",i.sv_price]})]})]}),i.sv_info&&e.jsx("p",{className:"text-[13px] text-[#86868b] mt-2 leading-relaxed",children:i.sv_info})]}),e.jsx("div",{className:"text-[#007AFF] text-xl ml-4",children:"‚Üí"})]})},i.sv_ID))})]},l))})]})}function Ee(){const{operators:r,selectOperator:s,filterSlots:t,setStep:a,prevStep:o}=N(),n=c=>{s(c),c.op_ID==="all"?t({}):t({operatoreId:c.op_ID}),a("calendar")};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-md mx-auto px-6 py-4 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>o(),className:"text-2xl",children:"‚Üê"}),e.jsx("h2",{className:"text-xl font-bold flex-1",children:"Scegli il barbiere"})]})}),e.jsxs("div",{className:"max-w-md mx-auto px-6 py-6 space-y-4",children:[e.jsx("button",{onClick:()=>n({op_ID:"all",op_name:"Qualsiasi operatore"}),className:"card-hover w-full text-left p-6 bg-gradient-to-r from-primary to-accent text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl mb-1",children:"üçÄ Mi Sento Fortunato"}),e.jsx("p",{className:"text-sm opacity-90",children:"Mostra tutti gli slot disponibili"})]}),e.jsx("div",{className:"text-3xl",children:"‚ú®"})]})}),r.map(c=>e.jsx("button",{onClick:()=>n(c),className:"card-hover w-full text-left p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-900 mb-1",children:["üë§ ",c.op_name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Orario: ",c.op_workStart," - ",c.op_workEnd]})]}),e.jsx("div",{className:"text-2xl text-primary",children:"‚Üí"})]})},c.op_ID))]})]})}const ze={lessThanXSeconds:{one:"meno di un secondo",other:"meno di {{count}} secondi"},xSeconds:{one:"un secondo",other:"{{count}} secondi"},halfAMinute:"alcuni secondi",lessThanXMinutes:{one:"meno di un minuto",other:"meno di {{count}} minuti"},xMinutes:{one:"un minuto",other:"{{count}} minuti"},aboutXHours:{one:"circa un'ora",other:"circa {{count}} ore"},xHours:{one:"un'ora",other:"{{count}} ore"},xDays:{one:"un giorno",other:"{{count}} giorni"},aboutXWeeks:{one:"circa una settimana",other:"circa {{count}} settimane"},xWeeks:{one:"una settimana",other:"{{count}} settimane"},aboutXMonths:{one:"circa un mese",other:"circa {{count}} mesi"},xMonths:{one:"un mese",other:"{{count}} mesi"},aboutXYears:{one:"circa un anno",other:"circa {{count}} anni"},xYears:{one:"un anno",other:"{{count}} anni"},overXYears:{one:"pi√π di un anno",other:"pi√π di {{count}} anni"},almostXYears:{one:"quasi un anno",other:"quasi {{count}} anni"}},Ce=(r,s,t)=>{let a;const o=ze[r];return typeof o=="string"?a=o:s===1?a=o.one:a=o.other.replace("{{count}}",s.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"tra "+a:a+" fa":a},Me={full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},$e={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Ae={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Te={date:H({formats:Me,defaultWidth:"full"}),time:H({formats:$e,defaultWidth:"full"}),dateTime:H({formats:Ae,defaultWidth:"full"})},q=["domenica","luned√¨","marted√¨","mercoled√¨","gioved√¨","venerd√¨","sabato"];function Be(r){switch(r){case 0:return"'domenica scorsa alle' p";default:return"'"+q[r]+" scorso alle' p"}}function Q(r){return"'"+q[r]+" alle' p"}function Oe(r){switch(r){case 0:return"'domenica prossima alle' p";default:return"'"+q[r]+" prossimo alle' p"}}const Le={lastWeek:(r,s,t)=>{const a=r.getDay();return J(r,s,t)?Q(a):Be(a)},yesterday:"'ieri alle' p",today:"'oggi alle' p",tomorrow:"'domani alle' p",nextWeek:(r,s,t)=>{const a=r.getDay();return J(r,s,t)?Q(a):Oe(a)},other:"P"},Re=(r,s,t,a)=>{const o=Le[r];return typeof o=="function"?o(s,t,a):o},Fe={narrow:["aC","dC"],abbreviated:["a.C.","d.C."],wide:["avanti Cristo","dopo Cristo"]},We={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1¬∫ trimestre","2¬∫ trimestre","3¬∫ trimestre","4¬∫ trimestre"]},Ue={narrow:["G","F","M","A","M","G","L","A","S","O","N","D"],abbreviated:["gen","feb","mar","apr","mag","giu","lug","ago","set","ott","nov","dic"],wide:["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"]},He={narrow:["D","L","M","M","G","V","S"],short:["dom","lun","mar","mer","gio","ven","sab"],abbreviated:["dom","lun","mar","mer","gio","ven","sab"],wide:["domenica","luned√¨","marted√¨","mercoled√¨","gioved√¨","venerd√¨","sabato"]},Ge={narrow:{am:"m.",pm:"p.",midnight:"mezzanotte",noon:"mezzogiorno",morning:"mattina",afternoon:"pomeriggio",evening:"sera",night:"notte"},abbreviated:{am:"AM",pm:"PM",midnight:"mezzanotte",noon:"mezzogiorno",morning:"mattina",afternoon:"pomeriggio",evening:"sera",night:"notte"},wide:{am:"AM",pm:"PM",midnight:"mezzanotte",noon:"mezzogiorno",morning:"mattina",afternoon:"pomeriggio",evening:"sera",night:"notte"}},qe={narrow:{am:"m.",pm:"p.",midnight:"mezzanotte",noon:"mezzogiorno",morning:"di mattina",afternoon:"del pomeriggio",evening:"di sera",night:"di notte"},abbreviated:{am:"AM",pm:"PM",midnight:"mezzanotte",noon:"mezzogiorno",morning:"di mattina",afternoon:"del pomeriggio",evening:"di sera",night:"di notte"},wide:{am:"AM",pm:"PM",midnight:"mezzanotte",noon:"mezzogiorno",morning:"di mattina",afternoon:"del pomeriggio",evening:"di sera",night:"di notte"}},Je=(r,s)=>{const t=Number(r);return String(t)},Ve={ordinalNumber:Je,era:M({values:Fe,defaultWidth:"wide"}),quarter:M({values:We,defaultWidth:"wide",argumentCallback:r=>r-1}),month:M({values:Ue,defaultWidth:"wide"}),day:M({values:He,defaultWidth:"wide"}),dayPeriod:M({values:Ge,defaultWidth:"wide",formattingValues:qe,defaultFormattingWidth:"wide"})},Xe=/^(\d+)(¬∫)?/i,Qe=/\d+/i,Ye={narrow:/^(aC|dC)/i,abbreviated:/^(a\.?\s?C\.?|a\.?\s?e\.?\s?v\.?|d\.?\s?C\.?|e\.?\s?v\.?)/i,wide:/^(avanti Cristo|avanti Era Volgare|dopo Cristo|Era Volgare)/i},Ke={any:[/^a/i,/^(d|e)/i]},Ze={narrow:/^[1234]/i,abbreviated:/^t[1234]/i,wide:/^[1234](¬∫)? trimestre/i},et={any:[/1/i,/2/i,/3/i,/4/i]},tt={narrow:/^[gfmalsond]/i,abbreviated:/^(gen|feb|mar|apr|mag|giu|lug|ago|set|ott|nov|dic)/i,wide:/^(gennaio|febbraio|marzo|aprile|maggio|giugno|luglio|agosto|settembre|ottobre|novembre|dicembre)/i},rt={narrow:[/^g/i,/^f/i,/^m/i,/^a/i,/^m/i,/^g/i,/^l/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ge/i,/^f/i,/^mar/i,/^ap/i,/^mag/i,/^gi/i,/^l/i,/^ag/i,/^s/i,/^o/i,/^n/i,/^d/i]},at={narrow:/^[dlmgvs]/i,short:/^(do|lu|ma|me|gi|ve|sa)/i,abbreviated:/^(dom|lun|mar|mer|gio|ven|sab)/i,wide:/^(domenica|luned[i|√¨]|marted[i|√¨]|mercoled[i|√¨]|gioved[i|√¨]|venerd[i|√¨]|sabato)/i},ot={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^g/i,/^v/i,/^s/i],any:[/^d/i,/^l/i,/^ma/i,/^me/i,/^g/i,/^v/i,/^s/i]},st={narrow:/^(a|m\.|p|mezzanotte|mezzogiorno|(di|del) (mattina|pomeriggio|sera|notte))/i,any:/^([ap]\.?\s?m\.?|mezzanotte|mezzogiorno|(di|del) (mattina|pomeriggio|sera|notte))/i},nt={any:{am:/^a/i,pm:/^p/i,midnight:/^mezza/i,noon:/^mezzo/i,morning:/mattina/i,afternoon:/pomeriggio/i,evening:/sera/i,night:/notte/i}},it={ordinalNumber:le({matchPattern:Xe,parsePattern:Qe,valueCallback:r=>parseInt(r,10)}),era:$({matchPatterns:Ye,defaultMatchWidth:"wide",parsePatterns:Ke,defaultParseWidth:"any"}),quarter:$({matchPatterns:Ze,defaultMatchWidth:"wide",parsePatterns:et,defaultParseWidth:"any",valueCallback:r=>r+1}),month:$({matchPatterns:tt,defaultMatchWidth:"wide",parsePatterns:rt,defaultParseWidth:"any"}),day:$({matchPatterns:at,defaultMatchWidth:"wide",parsePatterns:ot,defaultParseWidth:"any"}),dayPeriod:$({matchPatterns:st,defaultMatchWidth:"any",parsePatterns:nt,defaultParseWidth:"any"})},oe={code:"it",formatDistance:Ce,formatLong:Te,formatRelative:Re,localize:Ve,match:it,options:{weekStartsOn:1,firstWeekContainsDate:4}};function lt(){const{slots:r,operators:s,selectSlot:t,setStep:a,prevStep:o}=N(),n=p=>{t(p),a("form")},c=p=>{try{const[h,d]=p.split(" ");return(d==null?void 0:d.substring(0,5))||p}catch{return p}},m=p=>{try{const[h,d]=p.split(" "),[b,g,x]=h.split("/"),v=`${x}-${g}-${b}T${d}`,f=G(v);return Z(f,"EEEE d MMMM",{locale:oe})}catch{return p.split(" ")[0]}},l=p=>{const h=s.find(d=>d.op_ID===p);return(h==null?void 0:h.op_name)||""},i=r.reduce((p,h)=>{const d=h.at_startDateTime.split(" ")[0];return p[d]||(p[d]=[]),p[d].push(h),p},{}),u=Object.keys(i).length;return console.log(`üìÖ Slot raggruppati per ${u} giorni:`,Object.keys(i)),e.jsxs("div",{className:"min-h-screen bg-[#f5f5f7]",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-apple border-b border-[#d2d2d7] sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-6 py-4 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>o(),className:"text-[#007AFF] text-[17px] font-medium hover:opacity-60 transition-opacity",children:"‚Üê Indietro"}),e.jsx("h2",{className:"text-[17px] font-semibold text-[#1d1d1f] flex-1 text-center",children:"Scegli data e ora"}),e.jsx("div",{className:"w-20"})," "]})}),e.jsx("div",{className:"max-w-2xl mx-auto px-6 py-6 space-y-6 animate-fadeIn",children:Object.entries(i).map(([p,h])=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"sticky top-[73px] bg-[#f5f5f7] py-2 z-[5]",children:e.jsx("h3",{className:"text-[13px] font-semibold text-[#86868b] uppercase tracking-wide",children:m(h[0].at_startDateTime)})}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:h.map(d=>e.jsxs("button",{onClick:()=>n(d),className:"card-hover p-4 text-center min-h-[60px] flex flex-col items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-[17px] text-[#007AFF]",children:c(d.at_startDateTime)}),d.op_ID&&l(d.op_ID)&&e.jsx("div",{className:"text-[11px] text-[#86868b] mt-1 truncate w-full",children:l(d.op_ID)})]},d.at_ID))})]},p))})]})}function ct(){const{customer:r,selectedSlot:s,selectedService:t,selectedOperator:a,createBooking:o,setStep:n,prevStep:c}=N(),[m,l]=y.useState({customerName:(r==null?void 0:r.name)||"",customerPhone:(r==null?void 0:r.phone)||"",customerEmail:(r==null?void 0:r.email)||""}),[i,u]=y.useState(!1),p=async h=>{h.preventDefault(),u(!0);try{await o({slotId:s.at_ID,servizioId:t.sv_ID,operatoreId:(a==null?void 0:a.op_ID)||s.op_ID,...m}),n("confirm")}catch(d){alert("Errore durante la prenotazione: "+d.message)}finally{u(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-md mx-auto px-6 py-4 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>c(),className:"text-2xl",children:"‚Üê"}),e.jsx("h2",{className:"text-xl font-bold flex-1",children:"I tuoi dati"})]})}),e.jsx("div",{className:"max-w-md mx-auto px-6 py-6",children:e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[e.jsxs("div",{className:"card p-6 bg-primary/5",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"Riepilogo prenotazione"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:["‚úÇÔ∏è ",t==null?void 0:t.sv_name]}),e.jsxs("div",{children:["üë§ ",(a==null?void 0:a.op_name)||"Non specificato"]}),e.jsxs("div",{children:["‚è±Ô∏è ",t==null?void 0:t.sv_duration," min"]}),(t==null?void 0:t.sv_price)&&e.jsxs("div",{children:["üí∞ ‚Ç¨",t==null?void 0:t.sv_price]}),e.jsxs("div",{children:["üìÖ ",s==null?void 0:s.at_startDateTime]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Nome completo *"}),e.jsx("input",{type:"text",required:!0,value:m.customerName,onChange:h=>l({...m,customerName:h.target.value}),className:"w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-primary focus:outline-none",placeholder:"Mario Rossi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Telefono *"}),e.jsx("input",{type:"tel",required:!0,value:m.customerPhone,onChange:h=>l({...m,customerPhone:h.target.value}),className:"w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-primary focus:outline-none",placeholder:"3331234567"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Email (opzionale)"}),e.jsx("input",{type:"email",value:m.customerEmail,onChange:h=>l({...m,customerEmail:h.target.value}),className:"w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-primary focus:outline-none",placeholder:"mario@email.com"})]})]}),e.jsx("button",{type:"submit",disabled:i,className:"btn-primary w-full text-lg py-4 disabled:opacity-50",children:i?"Prenotazione...":"‚úÖ Conferma Prenotazione"})]})})]})}function dt(){const{config:r,selectedSlot:s,selectedService:t,selectedOperator:a,customer:o,resetBooking:n,setStep:c}=N(),m=()=>{n(),c("welcome")},l=()=>{n(),c("my-bookings")},i=()=>{if(!s||!t)return;const p=new Date(s.at_startDateTime),h=new Date(p.getTime()+t.sv_duration*6e4),d=g=>g.toISOString().replace(/-|:|\.\d+/g,""),b=new URLSearchParams({action:"TEMPLATE",text:`${t.sv_name} - ${(r==null?void 0:r.shop_name)||"BarberBro"}`,dates:`${d(p)}/${d(h)}`,details:`Servizio: ${t.sv_name}
Operatore: ${(a==null?void 0:a.op_name)||"Non specificato"}
Durata: ${t.sv_duration} min
Prezzo: ‚Ç¨${t.sv_price}`,location:(r==null?void 0:r.shop_address)||(r==null?void 0:r.shop_name)||"BarberBro"});window.open(`https://calendar.google.com/calendar/render?${b.toString()}`,"_blank")},u=()=>{if(!s||!t)return;const p=new Date(s.at_startDateTime),h=new Date(p.getTime()+t.sv_duration*6e4),d=v=>v.toISOString().replace(/-|:|\.\d+/g,""),b=`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//BarberBro//Booking//IT
BEGIN:VEVENT
UID:${s.at_ID}@barberbro.app
DTSTAMP:${d(new Date)}
DTSTART:${d(p)}
DTEND:${d(h)}
SUMMARY:${t.sv_name} - ${(r==null?void 0:r.shop_name)||"BarberBro"}
DESCRIPTION:Servizio: ${t.sv_name}\\nOperatore: ${(a==null?void 0:a.op_name)||"Non specificato"}\\nDurata: ${t.sv_duration} min\\nPrezzo: ‚Ç¨${t.sv_price}
LOCATION:${(r==null?void 0:r.shop_address)||(r==null?void 0:r.shop_name)||"BarberBro"}
STATUS:CONFIRMED
END:VEVENT
END:VCALENDAR`,g=new Blob([b],{type:"text/calendar;charset=utf-8"}),x=document.createElement("a");x.href=URL.createObjectURL(g),x.download=`prenotazione-${s.at_ID}.ics`,document.body.appendChild(x),x.click(),document.body.removeChild(x)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-green-100 flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-8xl mb-6 animate-bounce",children:"üéâ"}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Prenotazione Confermata!"}),e.jsxs("p",{className:"text-gray-600 text-lg",children:["Ti aspettiamo da ",(r==null?void 0:r.shop_name)||"BarberBro"]})]}),e.jsxs("div",{className:"card p-8 mb-6",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-4 text-center",children:"Dettagli Prenotazione"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Servizio:"}),e.jsx("span",{className:"font-semibold",children:t==null?void 0:t.sv_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Operatore:"}),e.jsx("span",{className:"font-semibold",children:(a==null?void 0:a.op_name)||"Non specificato"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data e ora:"}),e.jsx("span",{className:"font-semibold",children:s==null?void 0:s.at_startDateTime})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Durata:"}),e.jsxs("span",{className:"font-semibold",children:[t==null?void 0:t.sv_duration," min"]})]}),(t==null?void 0:t.sv_price)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Prezzo:"}),e.jsxs("span",{className:"font-semibold text-primary",children:["‚Ç¨",t==null?void 0:t.sv_price]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:i,className:"btn-secondary w-full flex items-center justify-center gap-2",children:"üìÖ Aggiungi a Google Calendar"}),e.jsx("button",{onClick:u,className:"btn-secondary w-full flex items-center justify-center gap-2",children:"üì≤ Scarica per Apple/Outlook"}),e.jsx("button",{onClick:l,className:"btn-primary w-full",children:"ÔøΩ Vedi le mie prenotazioni"}),e.jsx("button",{onClick:m,className:"btn-text w-full",children:"üè† Torna alla home"})]})]})})}function mt(){const{config:r,customer:s,myBookings:t,loading:a,error:o,loadMyBookings:n,cancelBooking:c,setStep:m}=N();y.useEffect(()=>{s!=null&&s.phone&&n()},[s,n]);const l=async d=>{window.confirm("Sei sicuro di voler cancellare questa prenotazione?")&&await c(d)},i=d=>{try{const[b,g]=d.split(" "),[x,v,f]=b.split("/"),j=`${f}-${v}-${x}T${g}`,w=G(j);return Z(w,"EEEE d MMMM 'alle' HH:mm",{locale:oe})}catch{return d}},u=d=>{try{const[b,g]=d.split(" "),[x,v,f]=b.split("/"),j=`${f}-${v}-${x}T${g}`;return G(j)>new Date}catch{return!0}};if(a)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin text-6xl mb-4",children:"‚è≥"}),e.jsx("p",{className:"text-gray-600",children:"Carico le tue prenotazioni..."})]})});const p=t.filter(d=>u(d.at_startDateTime)),h=t.filter(d=>!u(d.at_startDateTime));return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-md mx-auto px-6 py-4 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>m("welcome"),className:"text-2xl hover:scale-110 transition-transform",children:"‚Üê"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Le mie prenotazioni"}),e.jsx("p",{className:"text-sm text-gray-600",children:(s==null?void 0:s.name)||"Cliente"})]})]})}),e.jsxs("div",{className:"max-w-md mx-auto p-6",children:[o&&e.jsx("div",{className:"card p-4 mb-6 bg-red-50 border-red-200",children:e.jsxs("p",{className:"text-red-700",children:["‚ùå ",o]})}),t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üìÖ"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Nessuna prenotazione"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Non hai ancora prenotato nessun appuntamento"}),e.jsx("button",{onClick:()=>m("service"),className:"btn-primary",children:"Prenota ora"})]}):e.jsxs("div",{className:"space-y-6",children:[p.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"üîú Prossimi appuntamenti"}),e.jsx("div",{className:"space-y-3",children:p.map(d=>e.jsxs("div",{className:"card card-hover p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:d.serviceName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["con ",d.operatorName]})]}),e.jsxs("span",{className:"text-lg font-bold text-primary",children:["‚Ç¨",d.at_price]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700 mb-3",children:[e.jsx("span",{children:"üìÖ"}),e.jsx("span",{children:i(d.at_startDateTime)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-3",children:[e.jsx("span",{children:"‚è±Ô∏è"}),e.jsxs("span",{children:[d.at_duration," minuti"]})]}),e.jsx("button",{onClick:()=>l(d.at_ID),className:"w-full py-2 px-4 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors font-medium text-sm",children:"‚ùå Cancella prenotazione"})]},d.at_ID))})]}),h.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"‚úÖ Appuntamenti passati"}),e.jsx("div",{className:"space-y-3",children:h.map(d=>e.jsxs("div",{className:"card p-4 opacity-75",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:d.serviceName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["con ",d.operatorName]})]}),e.jsxs("span",{className:"text-sm font-bold text-gray-600",children:["‚Ç¨",d.at_price]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("span",{children:"üìÖ"}),e.jsx("span",{children:i(d.at_startDateTime)})]})]},d.at_ID))})]})]}),e.jsx("button",{onClick:()=>m("welcome"),className:"btn-secondary w-full mt-6",children:"üè† Torna alla home"})]})]})}function B({message:r="Caricamento..."}){return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/10 to-accent/5",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-16 w-16 border-b-4 border-primary mb-4"}),e.jsx("p",{className:"text-xl text-gray-700 font-medium",children:r})]})})}function Y({error:r}){const{clearError:s,setStep:t}=N(),a=()=>{s(),t("welcome"),window.location.reload()};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs("div",{className:"card text-center p-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"‚ö†Ô∏è"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Ops! Qualcosa √® andato storto"}),e.jsx("p",{className:"text-gray-600 mb-6",children:r||"Errore sconosciuto. Riprova pi√π tardi."}),e.jsx("button",{onClick:a,className:"btn-primary w-full",children:"Riprova"})]})})})}class A extends Error{}A.prototype.name="InvalidTokenError";function ut(r){return decodeURIComponent(atob(r).replace(/(.)/g,(s,t)=>{let a=t.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}function pt(r){let s=r.replace(/-/g,"+").replace(/_/g,"/");switch(s.length%4){case 0:break;case 2:s+="==";break;case 3:s+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return ut(s)}catch{return atob(s)}}function ht(r,s){if(typeof r!="string")throw new A("Invalid token specified: must be a string");s||(s={});const t=s.header===!0?0:1,a=r.split(".")[t];if(typeof a!="string")throw new A(`Invalid token specified: missing part #${t+1}`);let o;try{o=pt(a)}catch(n){throw new A(`Invalid token specified: invalid base64 for part #${t+1} (${n.message})`)}try{return JSON.parse(o)}catch(n){throw new A(`Invalid token specified: invalid json for part #${t+1} (${n.message})`)}}function xt(){const{config:r,login:s}=N(),[t,a]=y.useState(""),[o,n]=y.useState(!1),c=async l=>{n(!0),a("");try{const i=ht(l.credential),u=i.email,p=i.name;console.log("‚úÖ Google OAuth success:",{email:u,name:p});const h=await s(u,p);h.success||a(h.error||"Errore durante il login")}catch(i){console.error("‚ùå Login error:",i),a(i.message||"Errore imprevisto durante il login")}finally{n(!1)}},m=()=>{a("Accesso Google annullato o fallito")};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#f5f5f7] to-white flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[r!=null&&r.shop_logo_url?e.jsx("img",{src:r.shop_logo_url,alt:r.shop_name,className:"w-24 h-24 mx-auto rounded-[24px] shadow-lg mb-4"}):e.jsx("div",{className:"w-24 h-24 mx-auto rounded-[24px] flex items-center justify-center mb-4 shadow-lg",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-primary-dark))"},children:e.jsx("span",{className:"text-white text-4xl",children:"üíà"})}),e.jsx("h1",{className:"text-3xl font-bold text-[#1d1d1f] mb-2",children:(r==null?void 0:r.shop_name)||"BarberBro"}),(r==null?void 0:r.shop_tagline)&&e.jsx("p",{className:"text-[#86868b] text-sm",children:r.shop_tagline})]}),e.jsxs("div",{className:"bg-white rounded-[20px] shadow-xl p-8 mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-[#1d1d1f] text-center mb-2",children:"Accedi per prenotare"}),e.jsx("p",{className:"text-[#86868b] text-center mb-8 text-sm",children:(r==null?void 0:r.login_required_message)||"Usa il tuo account Google per accedere in modo sicuro"}),e.jsx("div",{className:"flex justify-center mb-6",children:o?e.jsx("div",{className:"w-full h-12 bg-[#f5f5f7] rounded-[12px] flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 border-3 border-[#007AFF] border-t-transparent rounded-full animate-spin"})}):e.jsx(ye,{onSuccess:c,onError:m,useOneTap:!1,text:"signin_with",shape:"rectangular",theme:"outline",size:"large",width:"300"})}),t&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-[12px] p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-red-500 mr-2 flex-shrink-0",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-800 text-sm font-medium mb-1",children:"Errore di accesso"}),e.jsx("p",{className:"text-red-600 text-xs",children:t}),t.includes("non registrata")||t.includes("non abilitato")?e.jsxs("div",{className:"mt-3 pt-3 border-t border-red-200",children:[e.jsx("p",{className:"text-red-700 text-xs font-medium mb-2",children:"Cosa fare:"}),e.jsxs("ul",{className:"text-red-600 text-xs space-y-1 ml-4 list-disc",children:[e.jsx("li",{children:"Contatta il negozio per registrarti"}),e.jsx("li",{children:"Verifica di usare l'email corretta"}),(r==null?void 0:r.phone_contact)&&e.jsxs("li",{children:["Chiama: ",e.jsx("a",{href:`tel:${r.phone_contact}`,className:"underline font-medium",children:r.phone_contact})]})]})]}):null]})]})}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-[#86868b] text-xs",children:["üîí Accesso sicuro tramite Google OAuth",e.jsx("br",{}),"Non memorizziamo password"]})})]}),((r==null?void 0:r.phone_contact)||(r==null?void 0:r.email_contact))&&e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("p",{className:"text-[#86868b] text-xs",children:"Non hai un account?"}),e.jsxs("div",{className:"flex justify-center gap-4",children:[r.phone_contact&&e.jsx("a",{href:`tel:${r.phone_contact}`,className:"text-[#007AFF] text-sm font-medium hover:underline",children:"üìû Chiamaci"}),r.email_contact&&e.jsx("a",{href:`mailto:${r.email_contact}`,className:"text-[#007AFF] text-sm font-medium hover:underline",children:"‚úâÔ∏è Email"})]})]})]})})}function ft(){const{currentStep:r,config:s,auth:t,loading:a,error:o,loadConfig:n,checkAuth:c,loadServices:m,loadOperators:l,loadSlots:i,services:u,operators:p}=N(),[h,d]=y.useState(!1),[b,g]=y.useState(!1),[x,v]=y.useState(!1);if(y.useEffect(()=>{n(),c();const w=setTimeout(()=>{d(!0)},1e4);return()=>clearTimeout(w)},[]),y.useEffect(()=>{(async()=>{if(t.isAuthenticated&&!x&&!b){console.log("üöÄ Caricamento dati iniziali dopo login..."),g(!0);try{await Promise.all([m(),l(),i({})]),console.log("‚úÖ Dati iniziali caricati con successo!"),v(!0)}catch(_){console.error("‚ùå Errore caricamento dati iniziali:",_)}finally{g(!1)}}})()},[t.isAuthenticated,x]),y.useEffect(()=>{s&&!s.google_client_id&&(console.warn("‚ö†Ô∏è google_client_id mancante, ricarico config..."),n())},[s]),y.useEffect(()=>{if(s){const w=z=>{const I=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(z);return I?`${parseInt(I[1],16)}, ${parseInt(I[2],16)}, ${parseInt(I[3],16)}`:"0, 122, 255"};document.documentElement.style.setProperty("--color-primary",s.primary_color||"#007AFF"),document.documentElement.style.setProperty("--color-primary-rgb",w(s.primary_color||"#007AFF")),document.documentElement.style.setProperty("--color-primary-dark",s.primary_color_dark||"#0051D5"),document.documentElement.style.setProperty("--color-secondary",s.secondary_color||"#34C759"),document.documentElement.style.setProperty("--color-accent",s.accent_color||"#C19A6B"),document.documentElement.style.setProperty("--color-background",s.background_color||"#F5F5F7"),document.documentElement.style.setProperty("--color-text",s.text_color||"#1D1D1F"),document.documentElement.style.setProperty("--color-text-secondary",s.text_secondary_color||"#86868B");const _=s.pwa_theme_color||s.primary_color||"#007AFF",P=document.querySelector('meta[name="theme-color"]');P&&P.setAttribute("content",_),document.title=`${s.shop_name||"BarberBro"} - Booking`}},[s]),a&&!s)return e.jsx(B,{});if(o)return e.jsx(Y,{error:o});if(!s||!s.shop_name)return e.jsx(B,{});const f=s.google_client_id;if(!f)return h?e.jsx(Y,{error:"Configurazione OAuth mancante. Contatta l'amministratore per configurare google_client_id nel foglio ConfigPWA."}):e.jsx(B,{message:"Caricamento configurazione..."});function j(){switch(r){case"welcome":return e.jsx(X,{});case"service":return e.jsx(Pe,{});case"operators":return e.jsx(Ee,{});case"calendar":return e.jsx(lt,{});case"form":return e.jsx(ct,{});case"confirm":return e.jsx(dt,{});case"my-bookings":return e.jsx(mt,{});default:return e.jsx(X,{})}}return e.jsx(fe,{clientId:f,children:e.jsx("div",{className:"min-h-screen bg-[#f5f5f7]",children:t.isAuthenticated?b?e.jsx(B,{message:"Caricamento dati..."}):j():e.jsx(xt,{})})})}re(document.getElementById("root")).render(e.jsx(y.StrictMode,{children:e.jsx(ft,{})}));
